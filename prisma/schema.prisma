generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String        @id @default(cuid())
  email     String        @unique
  role      String        @default("user")
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  sessions  QuizSession[]

  @@map("users")
}

model QuizSession {
  id          String       @id @default(cuid())
  userId      String?
  quizType    String       @default("financial-profile") // Type of quiz (financial-profile, health-finance, marriage-finance)
  startedAt   DateTime     @default(now())
  completedAt DateTime?
  status      String       @default("in_progress")
  durationMs  Int?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  answers     QuizAnswer[]
  user        User?        @relation(fields: [userId], references: [id])
  result      Result?
  articleViews ArticleView[]

  @@map("quiz_sessions")
}

model QuizQuestion {
  id        String       @id @default(cuid())
  quizType  String       @default("financial-profile") // Type of quiz this question belongs to
  order     Int
  prompt    String
  type      String
  options   Json
  active    Boolean      @default(true)
  skipButton Boolean     @default(false) // Show skip option for this question
  continueButton Boolean @default(false) // Show continue button after answer selection
  continueButtonColor String @default("#09727c") // Color for continue button
  
  // Text customization options (optional fields)
  textUnderAnswers String? // Text to display under answer options (smaller, grey)
  textUnderButton String?  // Text to display under submit/continue button (smaller, grey)
  
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  answers   QuizAnswer[]
  triggers  ArticleTrigger[]
  loadingScreens LoadingScreen[]

  @@map("quiz_questions")
}

model QuizAnswer {
  id         String       @id @default(cuid())
  sessionId  String
  questionId String
  value      Json
  dwellMs    Int?
  createdAt  DateTime     @default(now())
  question   QuizQuestion @relation(fields: [questionId], references: [id])
  session    QuizSession  @relation(fields: [sessionId], references: [id])

  @@unique([sessionId, questionId])
  @@map("quiz_answers")
}

model Result {
  id        String      @id @default(cuid())
  sessionId String      @unique
  archetype String
  scores    Json
  createdAt DateTime    @default(now())
  session   QuizSession @relation(fields: [sessionId], references: [id])

  @@map("results")
}

model Article {
  id          String   @id @default(cuid())
  title       String
  content     String
  type        String   // "static", "ai_generated", "template"
  category    String   // "marriage", "health", "career", etc.
  tags        Json     // Array of tags for better matching
  
  // Customization fields similar to LoadingScreen
  subtitle           String?  // Optional subtitle
  personalizedText   String?  // Text that can include variables like {{name}}, {{answer}}, etc.
  backgroundColor    String   @default("#ffffff") // Background color
  textColor          String   @default("#000000") // Text color
  iconColor          String   @default("#3b82f6") // Icon color
  accentColor        String   @default("#ef4444") // Accent/CTA button color
  iconType           String   @default("document") // Type of icon (document, chart, heart, etc.)
  showIcon           Boolean  @default(true) // Whether to show icon
  showStatistic      Boolean  @default(true) // Whether to show statistic callout
  statisticText      String?  // Custom statistic text (e.g., "75% of people...")
  statisticValue     String?  // Custom statistic value (e.g., "75%")
  ctaText            String   @default("CONTINUE") // Call-to-action button text
  showCta            Boolean  @default(true) // Whether to show CTA button
  
  // Layout and positioning fields
  textAlignment      String   @default("center") // Text alignment (left, center, right)
  contentPosition    String   @default("center") // Content position (top, center, bottom)
  backgroundStyle    String   @default("solid") // Background style (solid, gradient)
  backgroundGradient String?  // Gradient CSS string
  contentPadding     String   @default("normal") // Content padding (compact, normal, spacious)
  showTopBar         Boolean  @default(true) // Whether to show top bar
  topBarColor        String   @default("#1f2937") // Top bar background color
  
  // Text formatting fields
  titleFontSize      String   @default("large") // Title font size (small, normal, large, xlarge)
  titleFontWeight    String   @default("bold") // Title font weight (normal, medium, semibold, bold, extrabold)
  contentFontSize    String   @default("normal") // Content font size (small, normal, large)
  contentFontWeight  String   @default("normal") // Content font weight (light, normal, medium, semibold)
  lineHeight         String   @default("normal") // Line height (tight, normal, relaxed, loose)
  
  // Image fields
  imageUrl           String?  // URL of uploaded image
  imageAlt           String?  // Alt text for accessibility
  showImage          Boolean  @default(false) // Whether to show the uploaded image
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  triggers    ArticleTrigger[]
  views       ArticleView[]

  @@map("articles")
}

model ArticleTrigger {
  id         String   @id @default(cuid())
  articleId  String
  questionId String?
  optionValue String? // Specific option value that triggers this article
  condition  Json     // Complex conditions (e.g., score ranges, multiple answers)
  priority   Int      @default(0) // Higher priority = shown first
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  article    Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  question   QuizQuestion? @relation(fields: [questionId], references: [id])

  @@map("article_triggers")
}

model ArticleTemplate {
  id          String   @id @default(cuid())
  name        String
  template    String   // Template with variables like {{answer}}, {{score}}, etc.
  variables   Json     // Available variables for this template
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("article_templates")
}

model ArticleView {
  id        String   @id @default(cuid())
  sessionId String
  articleId String
  viewedAt  DateTime @default(now())
  session   QuizSession @relation(fields: [sessionId], references: [id])
  article   Article  @relation(fields: [articleId], references: [id])

  @@unique([sessionId, articleId])
  @@map("article_views")
}

model LoadingScreen {
  id              String   @id @default(cuid())
  quizType        String   // Which quiz this loading screen belongs to
  title           String   // Main title text
  subtitle        String?  // Optional subtitle
  personalizedText String? // Text that can include variables like {{name}}, {{answer}}, etc.
  duration        Int      @default(3000) // Duration in milliseconds
  iconType        String   @default("puzzle-4") // Type of animated icon (puzzle-4, puzzle-6, gears, brain, etc.)
  animationStyle  String   @default("complete-rotate") // Animation style (complete-rotate, spin, pulse, bounce, etc.)
  backgroundColor String   @default("#ffffff") // Background color
  textColor       String   @default("#000000") // Text color
  iconColor       String   @default("#3b82f6") // Icon color
  progressBarColor String  @default("#ef4444") // Progress bar color (legacy field)
  progressBarFillColor String @default("#fb513d") // Progress bar fill color
  progressBarBgColor String @default("#e4dece") // Progress bar background color
  progressBarTextColor String @default("#191717") // Progress bar text color
  showProgressBar Boolean  @default(true) // Whether to show progress bar
  progressText    String?  // Custom progress text (e.g., "CALCULATING...")
  showTopBar      Boolean  @default(true) // Whether to show top bar
  topBarColor     String   @default("#1f2937") // Top bar background color
  triggerQuestionId String? // Which question triggers this loading screen
  
  // Image fields
  imageUrl           String?  // URL of uploaded image
  imageAlt           String?  // Alt text for accessibility
  showImage          Boolean  @default(false) // Whether to show the uploaded image
  
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  question        QuizQuestion? @relation(fields: [triggerQuestionId], references: [id])

  @@map("loading_screens")
}
